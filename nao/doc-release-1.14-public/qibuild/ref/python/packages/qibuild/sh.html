
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>qibuild.sh – Common filesystem operations &mdash; qiBuild 1.14.5 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.14.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="qiBuild 1.14.5 documentation" href="../../../../index.html" />
    <link rel="up" title="qibuild modules" href="index.html" />
    <link rel="next" title="qibuild.log – Logging tools" href="log.html" />
    <link rel="prev" title="qibuild.archive – Manage .tar.gz and .zip files" href="archive.html" /> 
  </head>
  <body>

    <div class="document">
  <div id="custom-doc" class="yui-t3">
    <div id="hd">
      <h1><a href="../../../../index.html">qiBuild 1.14.5 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../../../index.html">Home</a>
        
         |
        <a title="Search" href="../../../../search.html">Search</a>
         |
        <a title="Index" href="../../../../genindex.html">Index</a>
        
         |
        <a title="CMake index" href="../../../../cmake-functions-index.html">CMake index</a>
         |
        <a title="Python index" href="../../../../py-modindex.html">Python index</a>
        
        
         |
        <a title="Back to main doc"
            href="../../../../../index.html"> Back to NAO Software Documentation </a>
        
      </div>
      <div class="nav">
    &laquo; <a href="archive.html" title="qibuild.archive &amp;#8211; Manage .tar.gz and .zip files">previous</a>
     |
    <a href="index.html" title="qibuild modules" accesskey="U">up</a>
   |
    <a href="log.html" title="qibuild.log &amp;#8211; Logging tools">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="ref-python-packages-qibuild-sh">
            
  <div class="section" id="module-qibuild.sh">
<span id="qibuild-sh-common-filesystem-operations"></span><h1>qibuild.sh &#8211; Common filesystem operations<a class="headerlink" href="#module-qibuild.sh" title="Permalink to this headline">¶</a></h1>
<p>Common filesystem operations</p>
<dl class="class">
<dt id="qibuild.sh.TempDir">
<em class="property">class </em><tt class="descclassname">qibuild.sh.</tt><tt class="descname">TempDir</tt><big>(</big><em>name='tmp'</em><big>)</big><a class="headerlink" href="#qibuild.sh.TempDir" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a nice wrapper around tempfile module.</p>
<p>Usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">TempDir</span><span class="p">(</span><span class="s">&quot;foo-bar&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
    <span class="n">subdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s">&quot;subdir&quot;</span><span class="p">)</span>
    <span class="n">do_foo</span><span class="p">(</span><span class="n">subdir</span><span class="p">)</span>
</pre></div>
</div>
<p>This piece of code makes sure that:</p>
<ul class="simple">
<li>a temporary directory named temp_dir has been
created (guaranteed to exist, be empty, and writeable)</li>
<li>the directory will be removed when the scope of
temp_dir has ended unless an exception has occurred
and DEBUG environment variable is set.</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.change_cwd">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">change_cwd</tt><big>(</big><em>*args</em>, <em>**kwds</em><big>)</big><a class="headerlink" href="#qibuild.sh.change_cwd" title="Permalink to this definition">¶</a></dt>
<dd><p>Change the current working dir</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.configure_file">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">configure_file</tt><big>(</big><em>in_path</em>, <em>out_path</em>, <em>copy_only=False</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#qibuild.sh.configure_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure a file.
:param in_path: input file
:parm out_path: output file</p>
<p>The out_path needs not to exist, missing leading directories will
be created if necessary.</p>
<p>If copy_only is True, the contents will be copied &#8220;as is&#8221;.</p>
<p>If not, we will use the args and kwargs parameter as in:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">in_content</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.install">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">install</tt><big>(</big><em>src</em>, <em>dest</em>, <em>filter_fun=None</em>, <em>quiet=False</em><big>)</big><a class="headerlink" href="#qibuild.sh.install" title="Permalink to this definition">¶</a></dt>
<dd><p>Install a directory to a destination.</p>
<p>If filter_fun is not None, then the file will only be
installed if filter_fun(relative/path/to/file) returns
True.</p>
<p>Few notes: rewriting <tt class="docutils literal"><span class="pre">cp</span></tt> or <tt class="docutils literal"><span class="pre">install</span></tt> is a hard problem.
This version will happily erase whatever is inside dest,
(even it the dest is readonly, dest will be erased before being
written) and it won&#8217;t complain if dest does not exists (missing
directories will simply be created)</p>
<p>This function will preserve relative symlinks between directories,
used for instance in Mac frameworks:</p>
<div class="highlight-python"><pre>|__ Versions
    |__ Current  -&gt; 4.0
    |__ 4        -&gt; 4.0
    |__ 4.0</pre>
</div>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.is_executable_binary">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">is_executable_binary</tt><big>(</big><em>file_path</em><big>)</big><a class="headerlink" href="#qibuild.sh.is_executable_binary" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if the file:
* is executable
* is a binary (i.e not a script)</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.is_runtime">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">is_runtime</tt><big>(</big><em>filename</em><big>)</big><a class="headerlink" href="#qibuild.sh.is_runtime" title="Permalink to this definition">¶</a></dt>
<dd><p>Filter function to only install runtime components of packages</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.ln">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">ln</tt><big>(</big><em>src</em>, <em>dst</em>, <em>symlink=True</em><big>)</big><a class="headerlink" href="#qibuild.sh.ln" title="Permalink to this definition">¶</a></dt>
<dd><p>ln (do not fail if file exists)</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.ls_r">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">ls_r</tt><big>(</big><em>directory</em><big>)</big><a class="headerlink" href="#qibuild.sh.ls_r" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a sorted list of all the files present in a diretory,
relative to this directory.</p>
<p>For instance, with:</p>
<div class="highlight-python"><pre>foo
|__ eggs
|    |__ c
|    |__ d
|__ empty
|__ spam
    |__a
    |__b</pre>
</div>
<p>ls_r(foo) returns:
[&#8220;eggs/c&#8221;, &#8220;eggs/d&#8221;, &#8220;empty/&#8221;, &#8220;spam/a&#8221;, &#8220;spam/b&#8221;]</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.mkdir">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">mkdir</tt><big>(</big><em>dest_dir</em>, <em>recursive=False</em><big>)</big><a class="headerlink" href="#qibuild.sh.mkdir" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursive mkdir (do not fail if file exists)</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.mv">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">mv</tt><big>(</big><em>src</em>, <em>dest</em><big>)</big><a class="headerlink" href="#qibuild.sh.mv" title="Permalink to this definition">¶</a></dt>
<dd><p>Move a file into a directory, but do not crash
if dest/src exists</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.rm">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">rm</tt><big>(</big><em>name</em><big>)</big><a class="headerlink" href="#qibuild.sh.rm" title="Permalink to this definition">¶</a></dt>
<dd><p>This one can take a file or a directory.
Contrary to shutil.remove or os.remove, it:</p>
<ul class="simple">
<li>won&#8217;t fail if the directory does not exists</li>
<li>won&#8217;t fail if the directory contains read-only files</li>
<li>won&#8217;t fail if the file does not exists</li>
</ul>
<p>Please avoid using shutil.rmtree ...</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.rmtree">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">rmtree</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#qibuild.sh.rmtree" title="Permalink to this definition">¶</a></dt>
<dd><p>shutil.rmtree() on steroids.</p>
<p>Recursively removes a directory, even if it&#8217;s marked read-only.</p>
<p>shutil.rmtree() doesn&#8217;t work on Windows if any of the files or directories
are read-only, which svn repositories and some .svn files are.  We need to
be able to force the files to be writable (i.e., deletable) as we traverse
the tree.</p>
<p>Even with all this, Windows still sometimes fails to delete a file, citing
a permission error (maybe something to do with antivirus scans or disk
indexing).  The best suggestion any of the user forums had was to wait a
bit and try again, so we do that too.  It&#8217;s hand-waving, but sometimes it
works. :/</p>
<p>On POSIX systems, things are a little bit simpler.  The modes of the files
to be deleted doesn&#8217;t matter, only the modes of the directories containing
them are significant.  As the directory tree is traversed, each directory
has its mode set appropriately before descending into it.  This should
result in the entire tree being removed, with the possible exception of
<tt class="docutils literal"><span class="pre">path</span></tt> itself, because nothing attempts to change the mode of its parent.
Doing so would be hazardous, as it&#8217;s not a directory slated for removal.
In the ordinary case, this is not a problem: for our purposes, the user
will never lack write permission on <tt class="docutils literal"><span class="pre">path</span></tt>&#8216;s parent.</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.run">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">run</tt><big>(</big><em>program</em>, <em>args</em><big>)</big><a class="headerlink" href="#qibuild.sh.run" title="Permalink to this definition">¶</a></dt>
<dd><p>exec a process.</p>
<ul class="simple">
<li>linux: this will call exec and replace the current process</li>
<li>windows: this will call spawn and wait till the end</li>
</ul>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">run</span><span class="p">(</span><span class="s">&quot;python.exe&quot;</span><span class="p">,</span> <span class="s">&quot;toto.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.safe_copy">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">safe_copy</tt><big>(</big><em>src</em>, <em>dest</em><big>)</big><a class="headerlink" href="#qibuild.sh.safe_copy" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy a source to a destination but
do not overwrite dest if it is more recent than src</p>
<p>Create any missing directories when necessary</p>
<p>If dest is a directory, src will be copied inside dest.</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.to_dos_path">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">to_dos_path</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#qibuild.sh.to_dos_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DOS path from a &#8220;windows with /&#8221; path.
Useful because people sometimes use forward slash in
environment variable, for instance</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.to_native_path">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">to_native_path</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#qibuild.sh.to_native_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an absolute, native path from a path,
(and all lower-case on case-insensitive filesystems)</p>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.to_posix_path">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">to_posix_path</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#qibuild.sh.to_posix_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a POSIX path from a DOS path</p>
<p>Useful because cmake <em>needs</em> POSIX paths.</p>
<dl class="docutils">
<dt>Guidelines:</dt>
<dd><ul class="first last simple">
<li>always use os.path insternally</li>
<li>convert to POSIX path at the very last moment</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="qibuild.sh.which">
<tt class="descclassname">qibuild.sh.</tt><tt class="descname">which</tt><big>(</big><em>program</em><big>)</big><a class="headerlink" href="#qibuild.sh.which" title="Permalink to this definition">¶</a></dt>
<dd><p>find program in the environment PATH
:return: path to program if found, None otherwise</p>
</dd></dl>

</div>


          </div>
          <div class="footernav">
    &laquo; <a href="archive.html" title="qibuild.archive &amp;#8211; Manage .tar.gz and .zip files">qibuild.archive &#8211; Manage .tar.gz and .zip files</a>
     |
    <a href="index.html" title="qibuild modules" accesskey="U">qibuild modules</a>
   |
    <a href="log.html" title="qibuild.log &amp;#8211; Logging tools">qibuild.log &#8211; Logging tools</a> &raquo;</div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>


  <h3>Table Of Contents</h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../qibuild_in_five_minutes.html">qiBuild in five minutes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">qiBuild reference documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../man/index.html">qibuild man Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cmake/api.html">qiBuild CMake API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cfg/index.html">Configuration files syntax</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">qiBuild Python documentation</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">qiBuild Python packages documentation</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html">qibuild modules</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="toc.html">qibuild.toc &#8211; TOC means Obvious Compilation</a></li>
<li class="toctree-l5"><a class="reference internal" href="project.html">qibuild.project &#8211; Managing <tt class="docutils literal"><span class="pre">projects</span></tt></a></li>
<li class="toctree-l5"><a class="reference internal" href="worktree.html">qibuild.worktree &#8211; Using a <tt class="docutils literal"><span class="pre">worktree</span></tt></a></li>
<li class="toctree-l5"><a class="reference internal" href="dependencies_solver.html">qibuild.dependencies_solver &#8211; Resolving dependencies</a></li>
<li class="toctree-l5"><a class="reference internal" href="cmdparse.html">qibuild.cmdparse &#8211; Parsing command line</a></li>
<li class="toctree-l5"><a class="reference internal" href="parsers.html">qibuild.parsers &#8211; Parsers for qibuild actions</a></li>
<li class="toctree-l5"><a class="reference internal" href="cmake.html">qibuild.cmake - CMake tools</a></li>
<li class="toctree-l5"><a class="reference internal" href="build.html">qibuild.build - Build tools</a></li>
<li class="toctree-l5"><a class="reference internal" href="ctest.html">qibuild.ctest &#8211; Implementation of CTest in Python</a></li>
<li class="toctree-l5"><a class="reference internal" href="envsetter.html">qibuild.envsetter &#8211; controlling environment variables</a></li>
<li class="toctree-l5"><a class="reference internal" href="command.html">qibuild.command - Launch processes</a></li>
<li class="toctree-l5"><a class="reference internal" href="config.html">qibuild.config &#8211; Managing qiBuild config files</a></li>
<li class="toctree-l5"><a class="reference internal" href="archive.html">qibuild.archive &#8211; Manage .tar.gz and .zip files</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="">qibuild.sh &#8211; Common filesystem operations</a></li>
<li class="toctree-l5"><a class="reference internal" href="log.html">qibuild.log &#8211; Logging tools</a></li>
<li class="toctree-l5"><a class="reference internal" href="interact.html">qibuild.interact &#8211; Interacting with the user</a></li>
<li class="toctree-l5"><a class="reference internal" href="wizard.html">qibuild.wizard &#8211; Configuration wizards</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../qitoolchain/index.html">qitoolchain modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../qisrc/index.html">qisrc modules</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide/index.html">qiBuild Programming guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contrib/index.html">Contributing to qiBuild</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design/cmake/managing_deps.html">Managing dependences with qiBuild: an overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design/cmake/searching.html">Search order</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design/cmake/shared_libs.html">Managing shared libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design/cmake/index.html">qiBuild CMake framework design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design/python/overviews/parsing_cmdline.html">Parsing command line arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design/python/overviews/handling_build_configurations.html">Handling build configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design/python/overviews/handling_cmake_flags.html">Handling CMake flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design/python/overviews/parsing_toolchain_feeds.html">Parsing toolchain feeds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design/python/index.html">qiBuild Python framework design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design/index.html">qiBuild design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../other_build_frameworks.html">qiBuild compared to other build frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../relnotes.html">qiBuild release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../news/1.12.1.html">What&#8217;s new in qibuild 1.12.1</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contrib/reporting_bugs.html">Reporting qiBuild issues</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contrib/cmake/coding_guide.html">CMake coding guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contrib/python/coding_guide.html">Python coding guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contrib/test_driven_development.html">qibuild: using test driven development</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contrib/running_test_suite.html">Running qiBuild test suite</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contrib/writing_documentation.html">Writing qiBuild documentation</a></li>
</ul>

        </div>
      </div>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="archive.html" title="qibuild.archive &amp;#8211; Manage .tar.gz and .zip files">previous</a>
     |
    <a href="index.html" title="qibuild modules" accesskey="U">up</a>
   |
    <a href="log.html" title="qibuild.log &amp;#8211; Logging tools">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>